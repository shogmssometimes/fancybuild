import{r as o,j as e,D as c,R as u,c as C}from"./index-B6yTUC-u.js";const m="collapse.mode",p=s=>`/fancybuild/${s}`,h=()=>{if(typeof window>"u")return"hub";const s=window.location.hash.replace(/^#\/?/,""),[t,r]=s.split(/[\/?]/);return t==="player"?r==="ops"?"player-ops":"player":t==="gm"?r==="ops"?"gm-ops":"gm":t==="chud"?"chud":t==="csmatrix"?"csmatrix":"hub"},k=()=>{if(typeof window>"u")return"player";const s=window.localStorage.getItem(m),t=h();return t==="gm"||t==="gm-ops"?"gm":t==="player"||t==="player-ops"||t==="chud"||t==="csmatrix"?"player":s??"player"},y=({title:s,src:t,onBack:r,note:a})=>e.jsxs("main",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:r,children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:s})]})]}),e.jsx("div",{className:"subapp-frame",children:e.jsx("iframe",{title:s,src:t,style:{border:"none"},allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-pointer-lock"})})]}),w=({onBack:s,children:t,chudDock:r})=>{const a=()=>{typeof window<"u"&&window.dispatchEvent(new Event("chud-open"))};return e.jsxs("div",{className:"player-shell",style:{minHeight:"100vh",background:"var(--bg-dark)"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:s,"aria-label":"Back to hub",children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:"Collapse Companion"})]}),e.jsx("div",{className:"topbar-actions",children:e.jsx("button",{className:"chud-top-btn",onClick:a,"aria-label":"Open cHUD overlay",children:"cHUD"})})]}),r,t]})},b=({onBack:s,children:t,chudDock:r})=>{const a=()=>{typeof window<"u"&&window.dispatchEvent(new Event("chud-open"))};return e.jsxs("div",{className:"gm-shell",style:{minHeight:"100vh",background:"var(--bg-dark)"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:s,"aria-label":"Back to hub",children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse GM Companion"}),e.jsx("strong",{children:"GM Tools"})]}),e.jsx("div",{className:"topbar-actions",children:e.jsx("button",{className:"chud-top-btn",onClick:a,"aria-label":"Open cHUD overlay",children:"cHUD"})})]}),r,t]})},j=({eyebrow:s,title:t,description:r,helper:a})=>e.jsx("div",{className:"page",children:e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",style:{fontSize:"0.9rem",textTransform:"uppercase",letterSpacing:"0.08em"},children:s}),e.jsx("h1",{style:{margin:"0.15rem 0 0.35rem 0"},children:t}),e.jsx("p",{className:"muted",style:{margin:0},children:r})]}),a&&e.jsx("div",{className:"muted text-body",style:{maxWidth:320,textAlign:"right"},children:a})]})}),M=({basePath:s})=>{const[t,r]=u.useState(!1);return u.useEffect(()=>{const a=()=>r(!0);return window.addEventListener("chud-open",a),()=>window.removeEventListener("chud-open",a)},[]),e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"chud-fab",onClick:()=>r(!0),"aria-label":"Open cHUD overlay",children:"cHUD"}),t&&e.jsx("div",{className:"chud-overlay",role:"dialog","aria-modal":"true","aria-label":"cHUD overlay",children:e.jsxs("div",{className:"chud-sheet",children:[e.jsxs("div",{className:"chud-sheet-header",children:[e.jsx("span",{children:"cHUD"}),e.jsx("button",{className:"chud-close",onClick:()=>r(!1),"aria-label":"Close cHUD",children:"✕"})]}),e.jsx("div",{className:"chud-sheet-body",children:e.jsx("iframe",{title:"cHUD",src:`${s}chud/index.html`,allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-pointer-lock"})})]})})]})},N=({mode:s,onModeChange:t,onNavigate:r})=>{const a=o.useMemo(()=>[{id:"player",title:"Companion — Player",description:"Player-facing tools with deck builder and ops.",cta:"Open Player Companion",subtitle:"Player"},{id:"player-ops",title:"Deck Ops — Player",description:"Standalone deck operations for the player deck.",cta:"Open Player Deck Ops",subtitle:"Player"},{id:"gm",title:"Companion — GM",description:"GM-only deck tools with pure counts.",cta:"Open GM Companion",subtitle:"GM"},{id:"gm-ops",title:"Deck Ops — GM",description:"Standalone deck operations for the GM deck.",cta:"Open GM Deck Ops",subtitle:"GM"},{id:"csmatrix",title:"CS Matrix",description:"Campaign Support Matrix with draggable nodes.",cta:"Open CS Matrix",subtitle:"Player"},{id:"chud",title:"cHUD",description:"Compact HUD for derived stats.",cta:"Open cHUD",subtitle:"Player"}].filter(l=>s==="gm"?l.subtitle==="GM":l.subtitle==="Player"),[s]);return e.jsx("main",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{width:"min(1100px, 100%)",padding:"1.25rem 1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"0.75rem",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:"0 0 0.35rem 0"},children:"Collapse Full Build"}),e.jsx("p",{style:{margin:0,color:"var(--muted)"},children:"Choose a mode to open the companion and deck ops independently."})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{color:"var(--muted)",fontSize:"0.9rem"},children:"Mode:"}),e.jsx("button",{className:`mode-toggle ${s==="player"?"active":""}`,onClick:()=>t("player"),"aria-pressed":s==="player",children:"Player"}),e.jsx("button",{className:`mode-toggle ${s==="gm"?"active":""}`,onClick:()=>t("gm"),"aria-pressed":s==="gm",children:"GM"})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem",marginTop:"1.1rem"},children:a.map(n=>e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:16,padding:"1rem",background:"var(--surface)",minHeight:180,display:"flex",flexDirection:"column",justifyContent:"space-between",gap:"0.75rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"baseline"},children:[e.jsx("h2",{style:{margin:0},children:n.title}),e.jsx("span",{style:{color:"var(--muted)",fontSize:"0.9rem"},children:n.subtitle})]}),e.jsx("p",{style:{color:"var(--muted)",marginTop:"0.5rem"},children:n.description})]}),e.jsx("button",{onClick:()=>r(n.id),children:n.cta})]},n.id))})]})})};function D(){const[s,t]=o.useState(()=>h()),[r,a]=o.useState(()=>k()),n=s!=="chud"?e.jsx(M,{basePath:p("")}):null;o.useEffect(()=>{const i=()=>{const d=h();if(t(d),d==="gm"||d==="gm-ops")a("gm");else if(d==="player"||d==="player-ops")a("player");else{const g=typeof window<"u"?window.localStorage.getItem(m):null;g&&a(g)}};return i(),window.addEventListener("hashchange",i),window.addEventListener("popstate",i),()=>{window.removeEventListener("hashchange",i),window.removeEventListener("popstate",i)}},[]),o.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(m,r)},[r]),o.useEffect(()=>{if(typeof window>"u")return;const i=(()=>{switch(s){case"player":return"#/player";case"player-ops":return"#/player/ops";case"gm":return"#/gm";case"gm-ops":return"#/gm/ops";case"chud":return"#/chud";case"csmatrix":return"#/csmatrix";default:return"#/hub"}})();window.location.hash!==i&&(window.location.hash=i)},[s]);const l=o.useMemo(()=>[{id:"gm-base-1",name:"Base",type:"Base"}],[]),f=o.useMemo(()=>[{id:"gm-mod-1",name:"Mod",type:"Modifier",cost:1}],[]),x=o.useMemo(()=>({id:"gm-null",name:"Null",type:"Null"}),[]);return s==="player"?e.jsx(w,{onBack:()=>t("hub"),chudDock:n,children:e.jsx(c,{showOpsSections:!1,showModifierCards:!0,showModifierCardCounter:!1,showModifierCapacity:!0,showBaseCounters:!0,showBaseAdjusters:!1})}):s==="player-ops"?e.jsx(w,{onBack:()=>t("hub"),chudDock:n,children:e.jsx(c,{storageKey:"collapse.deck-builder.v2",showBuilderSections:!1,showOpsSections:!0})}):s==="gm"?e.jsxs(b,{onBack:()=>t("hub"),chudDock:n,children:[e.jsx(j,{eyebrow:"GM Companion",title:"GM Deck & Table Tools",description:"Pure-count GM deck controls with offline storage, separate from player data.",helper:"Use this to prep encounters, lock decks, and keep the GM pool isolated."}),e.jsx(c,{storageKey:"collapse.deck-builder.gm.v1",exportPrefix:"collapse-gm-deck",baseCardsOverride:l,modCardsOverride:f,nullCardOverride:x,baseTarget:15,minNulls:5,modifierCapacityDefault:10,showCardDetails:!1,simpleCounters:!0,modCapacityAsCount:!0,showOpsSections:!1,showModifierCards:!0,showModifierCapacity:!1})]}):s==="gm-ops"?e.jsxs(b,{onBack:()=>t("hub"),chudDock:n,children:[e.jsx(j,{eyebrow:"GM Deck Ops",title:"Operational View",description:"Minimal deck operations for live sessions, keeping the GM pool locked and quick to reach.",helper:"Builder sections stay hidden; use the dock to draw, shuffle, and manage discard."}),e.jsx(c,{storageKey:"collapse.deck-builder.gm.v1",exportPrefix:"collapse-gm-deck",baseCardsOverride:l,modCardsOverride:f,nullCardOverride:x,baseTarget:15,minNulls:5,modifierCapacityDefault:10,showCardDetails:!1,simpleCounters:!0,modCapacityAsCount:!0,showBuilderSections:!1,showOpsSections:!0})]}):s==="chud"?e.jsx(y,{title:"cHUD — Compact HUD",src:`${p("")}chud/index.html`,onBack:()=>t("hub"),note:"Loaded inside the fullbuild shell."}):s==="csmatrix"?e.jsx(y,{title:"CS Matrix",src:p("csmatrix/index.html"),onBack:()=>t("hub"),note:"Campaign Support Matrix (in-app iframe)."}):e.jsxs(e.Fragment,{children:[n,e.jsx(N,{mode:r,onModeChange:i=>{a(i),t("hub")},onNavigate:i=>{t(i),a(i==="gm"||i==="gm-ops"?"gm":"player")}})]})}const v=document.getElementById("root");if(!v)throw new Error("Root element #root not found");C.createRoot(v).render(e.jsx(u.StrictMode,{children:e.jsx(D,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/fancybuild/sw.js").catch(t=>{console.error("Service worker registration failed",t)})});if(typeof window<"u")try{new URLSearchParams(window.location.search).get("debug")==="overflow"&&document.documentElement.classList.add("debug-overflow")}catch{}
