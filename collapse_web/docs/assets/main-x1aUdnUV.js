import{r as l,j as e,D as d,R as p,c as w}from"./index-B6lzw3C-.js";const b="collapse.mode",u=s=>`/fancybuild/${s}`,m=()=>{if(typeof window>"u")return"hub";const s=window.location.hash.replace(/^#\/?/,""),[r,t]=s.split(/[\/?]/);return r==="player"?t==="ops"?"player-ops":"player":r==="gm"?t==="ops"?"gm-ops":"gm":r==="chud"?"chud":r==="csmatrix"?"csmatrix":"hub"},v=()=>{if(typeof window>"u")return"player";const s=window.localStorage.getItem(b),r=m();return r==="gm"||r==="gm-ops"?"gm":r==="player"||r==="player-ops"||r==="chud"||r==="csmatrix"?"player":s??"player"},f=({title:s,src:r,onBack:t,note:i})=>e.jsxs("main",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:t,children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:s})]})]}),e.jsx("div",{className:"subapp-frame",children:e.jsx("iframe",{title:s,src:r,style:{border:"none"},allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-pointer-lock"})})]}),x=({onBack:s,children:r})=>e.jsxs("div",{className:"player-shell",style:{minHeight:"100vh",background:"var(--bg-dark)"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:s,"aria-label":"Back to hub",children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:"Collapse Companion"})]})]}),r]}),y=({onBack:s,children:r})=>e.jsxs("div",{className:"gm-shell",style:{minHeight:"100vh",background:"var(--bg-dark)"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:s,"aria-label":"Back to hub",children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse GM Companion"}),e.jsx("strong",{children:"GM Tools"})]})]}),r]}),C=({basePath:s})=>{const[r,t]=p.useState(!1);return p.useEffect(()=>{const i=()=>t(!0);return window.addEventListener("chud-open",i),()=>window.removeEventListener("chud-open",i)},[]),e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"chud-fab",onClick:()=>t(!0),"aria-label":"Open cHUD overlay",children:"cHUD"}),r&&e.jsx("div",{className:"chud-overlay",role:"dialog","aria-modal":"true","aria-label":"cHUD overlay",children:e.jsxs("div",{className:"chud-sheet",children:[e.jsxs("div",{className:"chud-sheet-header",children:[e.jsx("span",{children:"cHUD"}),e.jsx("button",{className:"chud-close",onClick:()=>t(!1),"aria-label":"Close cHUD",children:"✕"})]}),e.jsx("div",{className:"chud-sheet-body",children:e.jsx("iframe",{title:"cHUD",src:`${s}chud/`,allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-pointer-lock"})})]})})]})},k=({mode:s,onModeChange:r,onNavigate:t})=>{const i=l.useMemo(()=>[{id:"player",title:"Companion — Player",description:"Player-facing tools with deck builder and ops.",cta:"Open Player Companion",subtitle:"Player"},{id:"player-ops",title:"Deck Ops — Player",description:"Standalone deck operations for the player deck.",cta:"Open Player Deck Ops",subtitle:"Player"},{id:"gm",title:"Companion — GM",description:"GM-only deck tools with pure counts.",cta:"Open GM Companion",subtitle:"GM"},{id:"gm-ops",title:"Deck Ops — GM",description:"Standalone deck operations for the GM deck.",cta:"Open GM Deck Ops",subtitle:"GM"},{id:"csmatrix",title:"CS Matrix",description:"Campaign Support Matrix with draggable nodes.",cta:"Open CS Matrix",subtitle:"Player"},{id:"chud",title:"cHUD",description:"Compact HUD for derived stats.",cta:"Open cHUD",subtitle:"Player"}].filter(o=>s==="gm"?o.subtitle==="GM":o.subtitle==="Player"),[s]);return e.jsx("main",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{width:"min(1100px, 100%)",padding:"1.25rem 1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"0.75rem",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:"0 0 0.35rem 0"},children:"Collapse Full Build"}),e.jsx("p",{style:{margin:0,color:"var(--muted)"},children:"Choose a mode to open the companion and deck ops independently."})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{color:"var(--muted)",fontSize:"0.9rem"},children:"Mode:"}),e.jsx("button",{onClick:()=>r("player"),"aria-pressed":s==="player",style:{fontWeight:s==="player"?700:500},children:"Player"}),e.jsx("button",{onClick:()=>r("gm"),"aria-pressed":s==="gm",style:{fontWeight:s==="gm"?700:500},children:"GM"})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem",marginTop:"1.1rem"},children:i.map(n=>e.jsxs("div",{style:{border:"1px solid var(--border)",borderRadius:16,padding:"1rem",background:"var(--surface)",minHeight:180,display:"flex",flexDirection:"column",justifyContent:"space-between",gap:"0.75rem"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"baseline"},children:[e.jsx("h2",{style:{margin:0},children:n.title}),e.jsx("span",{style:{color:"var(--muted)",fontSize:"0.9rem"},children:n.subtitle})]}),e.jsx("p",{style:{color:"var(--muted)",marginTop:"0.5rem"},children:n.description})]}),e.jsx("button",{onClick:()=>t(n.id),children:n.cta})]},n.id))})]})})};function M(){const[s,r]=l.useState(()=>m()),[t,i]=l.useState(()=>v()),n=s!=="chud"?e.jsx(C,{basePath:u("")}):null;l.useEffect(()=>{const a=()=>{const c=m();r(c),i(c==="gm"||c==="gm-ops"?"gm":"player")};return a(),window.addEventListener("hashchange",a),window.addEventListener("popstate",a),()=>{window.removeEventListener("hashchange",a),window.removeEventListener("popstate",a)}},[]),l.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(b,t)},[t]),l.useEffect(()=>{if(typeof window>"u")return;const a=(()=>{switch(s){case"player":return"#/player";case"player-ops":return"#/player/ops";case"gm":return"#/gm";case"gm-ops":return"#/gm/ops";case"chud":return"#/chud";case"csmatrix":return"#/csmatrix";default:return"#/hub"}})();window.location.hash!==a&&(window.location.hash=a)},[s]);const o=l.useMemo(()=>[{id:"gm-base-1",name:"Base",type:"Base"}],[]),h=l.useMemo(()=>[{id:"gm-mod-1",name:"Mod",type:"Modifier",cost:1}],[]),g=l.useMemo(()=>({id:"gm-null",name:"Null",type:"Null"}),[]);return s==="player"?e.jsxs(x,{onBack:()=>r("hub"),children:[n,e.jsx(d,{})]}):s==="player-ops"?e.jsxs(x,{onBack:()=>r("hub"),children:[n,e.jsx(d,{forcePageIndex:1,hidePager:!0,storageKey:"collapse.deck-builder.v2"})]}):s==="gm"?e.jsx(y,{onBack:()=>r("hub"),children:e.jsx(d,{storageKey:"collapse.deck-builder.gm.v1",exportPrefix:"collapse-gm-deck",baseCardsOverride:o,modCardsOverride:h,nullCardOverride:g,baseTarget:15,minNulls:5,modifierCapacityDefault:10,showCardDetails:!1,simpleCounters:!0,modCapacityAsCount:!0})}):s==="gm-ops"?e.jsx(y,{onBack:()=>r("hub"),children:e.jsx(d,{storageKey:"collapse.deck-builder.gm.v1",exportPrefix:"collapse-gm-deck",baseCardsOverride:o,modCardsOverride:h,nullCardOverride:g,baseTarget:15,minNulls:5,modifierCapacityDefault:10,showCardDetails:!1,simpleCounters:!0,modCapacityAsCount:!0,forcePageIndex:1,hidePager:!0})}):s==="chud"?e.jsx(f,{title:"cHUD — Compact HUD",src:u("chud/"),onBack:()=>r("hub"),note:"Loaded inside the fullbuild shell."}):s==="csmatrix"?e.jsx(f,{title:"CS Matrix",src:u("csmatrix/"),onBack:()=>r("hub"),note:"Campaign Support Matrix (in-app iframe)."}):e.jsxs(e.Fragment,{children:[n,e.jsx(k,{mode:t,onModeChange:a=>{i(a),r("hub")},onNavigate:a=>{r(a),i(a==="gm"||a==="gm-ops"?"gm":"player")}})]})}const j=document.getElementById("root");if(!j)throw new Error("Root element #root not found");w.createRoot(j).render(e.jsx(p.StrictMode,{children:e.jsx(M,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/fancybuild/sw.js").catch(r=>{console.error("Service worker registration failed",r)})});if(typeof window<"u")try{new URLSearchParams(window.location.search).get("debug")==="overflow"&&document.documentElement.classList.add("debug-overflow")}catch{}
