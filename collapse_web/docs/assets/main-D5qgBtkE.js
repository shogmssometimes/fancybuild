import{j as e,r as l,D as f,R as h,c as g}from"./index-BBEzmCI_.js";const w=[{id:"player",title:"Player Mode",description:"Guided experience with read-only world events and your personal engram deck builder."},{id:"gm",title:"GM Mode",description:"Unlock world events, editable social matrix, and the deck builder for campaign prep."}],y={border:"1px solid var(--border)",borderRadius:16,padding:"1.25rem",background:"var(--surface)",minHeight:160,display:"flex",flexDirection:"column",justifyContent:"space-between",gap:"0.5rem"},b=({onSelect:n})=>e.jsx("main",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{width:"min(960px, 100%)",padding:"2rem"},children:[e.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Collapse Companion"}),e.jsx("p",{style:{marginBottom:"2rem",color:"var(--muted)"},children:"Pick a role to continue. You can switch later without losing progress."}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"1rem"},children:w.map(t=>e.jsxs("div",{style:y,children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0},children:t.title}),e.jsx("p",{style:{color:"var(--muted)",marginTop:"0.5rem"},children:t.description})]}),e.jsxs("button",{onClick:()=>n(t.id),children:["Enter ",t.id==="gm"?"GM":"Player"," Mode"]})]},t.id))})]})}),c=n=>`/fancybuild/${n}`,m=()=>{if(typeof window>"u")return"hub";const n=window.location.hash.replace(/^#\/?/,""),[t]=n.split(/[/?]/);return t==="cvttweb"?"cvttweb":t==="chud"?"chud":t==="csmatrix"?"csmatrix":t==="gm"?"gm":window.location.pathname.includes("/cvttweb")?"cvttweb":"hub"},p=()=>{if(typeof window>"u")return null;const n=window.location.hash.replace(/^#\/?/,""),[,t]=n.split("/");return t==="player"||t==="gm"?t:null},u=({title:n,src:t,onBack:s,note:i})=>e.jsxs("main",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:s,children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:n})]})]}),e.jsx("div",{className:"subapp-frame",children:e.jsx("iframe",{title:n,src:t,style:{border:"none"},allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-pointer-lock"})})]}),j=({onBack:n,children:t})=>e.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-dark)"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn",onClick:n,"aria-label":"Back to hub",children:"← Back to hub"}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:"Collapse Companion"})]})]}),t]}),v=({basePath:n})=>{const[t,s]=h.useState(!1);return e.jsxs("div",{className:`chud-dock ${t?"open":""}`,children:[e.jsx("button",{className:"chud-dock-toggle",onClick:()=>s(i=>!i),children:t?"Hide cHUD":"Show cHUD"}),t&&e.jsx("div",{className:"chud-dock-frame",children:e.jsx("iframe",{title:"cHUD",src:`${n}chud/`,allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-pointer-lock"})})]})},k=({onNavigate:n})=>{const t={border:"1px solid var(--border)",borderRadius:16,padding:"1rem",background:"var(--surface)",minHeight:180,display:"flex",flexDirection:"column",justifyContent:"space-between",gap:"0.75rem"},s=[{id:"cvttweb",title:"Companion — Player",description:"Player-facing tools with read-only world events and the deck builder.",cta:"Enter Player Mode",subtitle:"In-app",role:"player"},{id:"gm",title:"Companion — GM (Standalone)",description:"GM-only deck tools (pure counts). Player app remains unchanged.",cta:"Launch GM Companion",subtitle:"Standalone"},{id:"chud",title:"cHUD",description:"Compact HUD for derived stats; keep it alongside your session.",cta:"Open cHUD",subtitle:"In-app"},{id:"csmatrix",title:"CS Matrix",description:"Campaign Support Matrix with draggable nodes, meters, and node drawers.",cta:"Open CS Matrix",subtitle:"In-app"}];return e.jsx("main",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{width:"min(1100px, 100%)",padding:"1.25rem 1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",gap:"0.75rem",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:"0 0 0.35rem 0"},children:"Collapse Full Build"}),e.jsx("p",{style:{margin:0,color:"var(--muted)"},children:"Launch any build directly. Each experience runs inside this PWA and stays offline once loaded."})]}),e.jsx("span",{style:{color:"var(--muted)",fontSize:"0.95rem"},children:c("")})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem",marginTop:"1.1rem"},children:s.map(i=>e.jsxs("div",{style:t,children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"baseline"},children:[e.jsx("h2",{style:{margin:0},children:i.title}),e.jsx("span",{style:{color:"var(--muted)",fontSize:"0.9rem"},children:i.subtitle})]}),e.jsx("p",{style:{color:"var(--muted)",marginTop:"0.5rem"},children:i.description})]}),e.jsx("button",{onClick:()=>n(i.id,i.role),children:i.cta})]},i.id))})]})})};function C(){const[n,t]=l.useState(()=>m()),[s,i]=l.useState(()=>p()),d=n!=="chud"?e.jsx(v,{basePath:c("")}):null,o=l.useMemo(()=>({chud:{title:"cHUD — Compact HUD",src:c("chud/"),note:"Loaded inside the fullbuild shell."},csmatrix:{title:"CS Matrix",src:c("csmatrix/"),note:"Campaign Support Matrix (in-app iframe)."}}),[]);return l.useEffect(()=>{const r=()=>{t(m());const a=p();a&&i(a)};return r(),window.addEventListener("hashchange",r),window.addEventListener("popstate",r),()=>{window.removeEventListener("hashchange",r),window.removeEventListener("popstate",r)}},[]),l.useEffect(()=>{if(typeof window>"u")return;const r=n==="cvttweb"&&s?`#/${n}/${s}`:`#/${n}`;window.location.hash!==r&&(window.location.hash=r)},[n,s]),n==="gm"?e.jsx(u,{title:"Companion — GM",src:c("gm.html"),onBack:()=>t("hub"),note:"GM-only view; player app remains unchanged."}):n==="cvttweb"?s?e.jsxs(j,{onBack:()=>t("hub"),children:[d,e.jsx(f,{})]}):e.jsx(b,{onSelect:i}):n==="chud"?e.jsx(u,{title:o.chud.title,src:o.chud.src,note:o.chud.note,onBack:()=>t("hub")}):n==="csmatrix"?e.jsxs(e.Fragment,{children:[d,e.jsx(u,{title:o.csmatrix.title,src:o.csmatrix.src,note:o.csmatrix.note,onBack:()=>t("hub")})]}):e.jsxs(e.Fragment,{children:[d,e.jsx(k,{onNavigate:(r,a)=>{a&&i(a),t(r)}})]})}const x=document.getElementById("root");if(!x)throw new Error("Root element #root not found");g.createRoot(x).render(e.jsx(h.StrictMode,{children:e.jsx(C,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/fancybuild/sw.js").catch(t=>{console.error("Service worker registration failed",t)})});if(typeof window<"u")try{new URLSearchParams(window.location.search).get("debug")==="overflow"&&document.documentElement.classList.add("debug-overflow")}catch{}
